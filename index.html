<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Image Regions</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background: #f4f4f4;
            text-align: center;
        }

        #upload-container {
            margin: 20px;
        }

        #region-table {
            margin-top: 20px;
            width: 80%;
            margin: 20px auto;
            border-collapse: collapse;
            text-align: left;
        }

        #region-table th, #region-table td {
            padding: 8px;
            border: 1px solid #ccc;
        }

        #region-table th {
            background-color: #eee;
        }

        canvas {
            border: 2px solid #000;
            margin: 20px 0;
        }

        #color-input {
            margin-top: 20px;
        }

        #render-btn {
            margin-top: 20px;
        }
    </style>
</head>
<body>

    <div id="upload-container">
        <input type="file" id="image-input" accept="image/*">
        <button id="render-btn">Render Image</button>
        <input type="color" id="color-input" value="#ff0000">
    </div>

    <canvas id="canvas"></canvas>

    <table id="region-table" style="display: none;">
        <thead>
            <tr>
                <th>Region Name</th>
                <th>Color</th>
                <th>Position (X, Y)</th>
                <th>Size (Width, Height)</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>

    <script>
        const renderBtn = document.getElementById('render-btn');
        const imageInput = document.getElementById('image-input');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const regionTable = document.getElementById('region-table').getElementsByTagName('tbody')[0];
        const colorInput = document.getElementById('color-input');

        let img = new Image();
        let regions = [];
        let selectedRegion = null;
        let selectedColor = colorInput.value;

        renderBtn.addEventListener('click', () => {
            regionTable.innerHTML = ''; // Clear the table
            regionTable.style.display = 'block'; // Show the table

            // Draw the image to the canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(img, 0, 0);

            // Create regions based on detected areas or create manual regions
            // For simplicity, we'll create a sample region for testing
            regions = [
                { x: 50, y: 50, width: 100, height: 100, color: '#ff0000', name: 'Region 1' },
                { x: 200, y: 150, width: 150, height: 100, color: '#00ff00', name: 'Region 2' }
            ];

            regions.forEach(region => {
                ctx.strokeStyle = region.color;
                ctx.lineWidth = 2;
                ctx.strokeRect(region.x, region.y, region.width, region.height);
            });

            // Make regions clickable
            canvas.addEventListener('click', (event) => {
                const rect = canvas.getBoundingClientRect();
                const x = event.clientX - rect.left;
                const y = event.clientY - rect.top;

                regions.forEach((region, index) => {
                    if (
                        x >= region.x && x <= region.x + region.width &&
                        y >= region.y && y <= region.y + region.height
                    ) {
                        // Set the selected region
                        selectedRegion = region;
                        selectedRegion.index = index;

                        // Highlight the selected region
                        ctx.clearRect(0, 0, canvas.width, canvas.height);
                        ctx.drawImage(img, 0, 0);
                        regions.forEach(r => {
                            if (r !== selectedRegion) {
                                ctx.strokeStyle = r.color;
                                ctx.lineWidth = 2;
                                ctx.strokeRect(r.x, r.y, r.width, r.height);
                            }
                        });
                        ctx.strokeStyle = 'blue';
                        ctx.lineWidth = 2;
                        ctx.strokeRect(selectedRegion.x, selectedRegion.y, selectedRegion.width, selectedRegion.height);

                        // Prompt for region name
                        const regionName = prompt('Enter a name for this region:');
                        if (regionName) {
                            // Update the region name
                            selectedRegion.name = regionName;

                            // Add the name and color to the table
                            const row = regionTable.insertRow();
                            row.insertCell(0).textContent = selectedRegion.name;
                            row.insertCell(1).textContent = selectedColor;
                            row.insertCell(2).textContent = `${selectedRegion.x}, ${selectedRegion.y}`;
                            row.insertCell(3).textContent = `${selectedRegion.width}, ${selectedRegion.height}`;
                        }

                        // Ensure the table is visible after entering the name
                        regionTable.style.display = 'block';
                    }
                });
            });
        });

        // Handle color input change
        colorInput.addEventListener('input', (event) => {
            selectedColor = event.target.value;
            if (selectedRegion) {
                selectedRegion.color = selectedColor;
                // Re-draw the image with the updated color for the selected region
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(img, 0, 0);
                regions.forEach(r => {
                    if (r !== selectedRegion) {
                        ctx.strokeStyle = r.color;
                        ctx.lineWidth = 2;
                        ctx.strokeRect(r.x, r.y, r.width, r.height);
                    }
                });
                ctx.strokeStyle = 'blue';
                ctx.lineWidth = 2;
                ctx.strokeRect(selectedRegion.x, selectedRegion.y, selectedRegion.width, selectedRegion.height);
            }
        });

        // Handle image input change (image upload)
        imageInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    img.onload = function() {
                        // Resize canvas to fit the image
                        canvas.width = img.width;
                        canvas.height = img.height;
                        ctx.drawImage(img, 0, 0);
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        });
    </script>

</body>
</html>
